drop database if exists yxx;
create database yxx;
#########################################################################
#  test case 1: select outfile with enclosed and escaped param
#########################################################################
set names utf8mb4;
create table yxx.tt (id int primary key, name_1 char(64), name_2 varchar(64), name_3 varchar(64));
insert into yxx.tt  values(1111,'ABCD!@#$%^&*()','ABCD!@#$%^&*()', '123456789');
insert into yxx.tt values(2222, '"ab@cd"', x'03090A22405C5E', x'0102030405060708090A0B0C0D0E0F40');
# default outfile
load_file(concat('MYSQLTEST_VARDIR/tmp', "/outfile-test.1"))
1111	ABCD!@#$%^&*()	ABCD!@#$%^&*()	123456789
2222	"ab@cd"	\	\
"@\\^	\	\
@

# gdb_format 'jcsv' works well
load_file(concat('MYSQLTEST_VARDIR/tmp', "/outfile-test.2"))
1111	ABCD!@#$%^&*()                                                  	ABCD!@#$%^&*()	123456789
2222	"ab@cd"                                                         		
"@\^		
@

# gdb_format 'jcsv' works well when there is no fields enclosement
load_file(concat('MYSQLTEST_VARDIR/tmp', "/outfile-test.3"))
1111#ABCD!@#$%^&*()                                                  #ABCD!@#$%^&*()#123456789
2222#"ab@cd"                                                         #	
"@\^#	
@

# gdb_format 'jcsv' works well with empty string enclosement
load_file(concat('MYSQLTEST_VARDIR/tmp', "/outfile-test.4"))
1111#ABCD!@#$%^&*()                                                  #ABCD!@#$%^&*()#123456789
2222#"ab@cd"                                                         #	
"@\^#	
@

# gdb_format 'jcsv' works well with empty string enclosement and empty string terminater
# no spaces will be appended
load_file(concat('MYSQLTEST_VARDIR/tmp', "/outfile-test.5"))
1111ABCD!@#$%^&*()                                                  ABCD!@#$%^&*()123456789
2222"ab@cd"                                                         	
"@\^	
@

# gdb_format 'jcsv' works well with no enclosement and empty string terminater
# no spaces will be appended
load_file(concat('MYSQLTEST_VARDIR/tmp', "/outfile-test.6"))
1111ABCD!@#$%^&*()                                                  ABCD!@#$%^&*()123456789
2222"ab@cd"                                                         	
"@\^	
@

# ============================ bad cases ============================
# gdb_format 'jcsv' doesn't work with enclosed
ERROR HY000: Wrong usage for gdb_format: field enclosement must be empty when `JCSV` format is used
# gdb_format 'jcsv' doesn't work with optionally enclosed
ERROR HY000: Wrong usage for gdb_format: field enclosement must be empty when `JCSV` format is used
#########################################################################
#  test case 2: select outfile for text and blob field type
#########################################################################
create table yxx.blobtext (id int primary key, name1 text, name2 blob, name3 blob);
insert into yxx.blobtext  values(1111,'ABCD!@#$%^&*()','ABCD!@#$%^&*()', 'ABCD!@#$%^&*()');
insert into yxx.blobtext values(2222, '"ab@cd"', x'03090A22405C5E', x'0102030405060708090A0B0C0D0E0F40');
load_file(concat('MYSQLTEST_VARDIR/tmp', "/outfile-test.10"))
1111#ABCD!@#$%^&*()#ABCD!@#$%^&*()#ABCD!@#$%^&*()
2222#"ab@cd"#	
"@\^#	
@

# no spaces will be appended when enclosement and terminater are all empty
load_file(concat('MYSQLTEST_VARDIR/tmp', "/outfile-test.11"))
1111ABCD!@#$%^&*()ABCD!@#$%^&*()ABCD!@#$%^&*()
2222"ab@cd"	
"@\^	
@

drop table if exists yxx.blobtext;
"restore charactor set:"
#########################################################################
#  test case 3: select outfile for every ASCII char
#########################################################################
create table yxx.asciitest (id int primary key, name1 text) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
insert into yxx.asciitest values(1, x'0102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f');
insert into yxx.asciitest values(2,"ä¸­å…´é€šè®¯åœ¨æ•°æ®åº“é¢†åŸŸå…·å¤‡è¶…è¿‡åä¸ƒå¹´çš„æŠ€æœ¯ç§¯ç´¯ï¼Œè‡ª2002å¹´å¼€å§‹å…ˆåè‡ªä¸»ç ”å‘æ–‡ä»¶æ•°æ®åº“ã€å†…å­˜æ•°æ®åº“ã€åˆ†å¸ƒå¼æ•°æ®åº“ç­‰äº§å“å¹¶å¤§è§„æ¨¡æœåŠ¡ç”µä¿¡é¢†åŸŸäº§å“ï¼›2014å¹´ç‡å…ˆæ‹“å±•é‡‘èè¡Œä¸šåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œè¯¥äº§å“å®Œå…¨è‡ªä¸»ç ”å‘å¹¶è·å¾—100å¤šé¡¹ç›¸å…³ä¸“åˆ©ã€‚é’ˆå¯¹é“¶è¡ŒOLTPä¸šåŠ¡ï¼Œä¸­å…´é€šè®¯åˆ†å¸ƒå¼æ•°æ®åº“GoldenDBä¸ºä¸šåŠ¡å¸¦æ¥ä¼ ç»Ÿå•æœºæ•°æ®åº“æ— æ³•æä¾›çš„è®¡ç®—åŠæ‰©å±•èƒ½åŠ›ï¼Œæä¾›é«˜ å¯ç”¨ã€é«˜å¯é ã€èµ„æºè°ƒåº¦çµæ´»çš„æ•°æ®åº“æœåŠ¡ï¼Œæ”¯æŒé‡‘èè¡Œä¸šå·²æœ‰ä¸šåŠ¡å‡çº§åŠåˆ›æ–°ä¸šåŠ¡å¿«é€Ÿéƒ¨ç½²çš„éœ€æ±‚ã€‚ä¸­å…´é€šè®¯GoldenDBåˆ†å¸ƒå¼æ•°æ®åº“ å·²ç»åœ¨ä¸­ä¿¡é“¶è¡Œã€æ±Ÿè‹çœå†œæ‘ä¿¡ç”¨ç¤¾è”åˆç¤¾ã€æ±Ÿè‹é“¶è¡Œã€æ¹–å—çœæ”¿åºœã€æ¹–åŒ—ä»™æ¡ƒå¸‚æ”¿åºœç­‰å•ä½æˆåŠŸå•†ç”¨ï¼Œä¸»è¦åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼šé«˜å¹¶å‘åœº æ™¯ï¼šé’ˆå¯¹æ”¿åºœã€é‡‘èã€è¿è¥å•†ã€äº’è”ç½‘ä¸šåŠ¡å¯¹æ•°æ®åº“çš„é«˜å¹¶å‘äº¤æ˜“çš„è¦æ±‚ï¼Œä¸”å¯ä»¥ä¿è¯æ•°æ®çš„äº‹åŠ¡å¼ºä¸€è‡´æ€§ã€‚æµ·é‡æ•°æ®å­˜å‚¨è®¿é—®åœºæ™¯ï¼š é’ˆå¯¹ç°æœ‰å•æœºæ•°æ®åº“çš„å­˜å‚¨å®¹é‡å’Œæ€§èƒ½é™åˆ¶ï¼Œæä¾›å¤§å®¹é‡ã€å¯æ°´å¹³å¹³æ»‘æ‰©å®¹çš„æ•°æ®åº“è§£å†³æ–¹æ¡ˆã€‚");
load_file(concat('MYSQLTEST_VARDIR/tmp', "/outfile-test.7"))
1#	
 !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~@@2#ä¸­å…´é€šè®¯åœ¨æ•°æ®åº“é¢†åŸŸå…·å¤‡è¶…è¿‡åä¸ƒå¹´çš„æŠ€æœ¯ç§¯ç´¯ï¼Œè‡ª2002å¹´å¼€å§‹å…ˆåè‡ªä¸»ç ”å‘æ–‡ä»¶æ•°æ®åº“ã€å†…å­˜æ•°æ®åº“ã€åˆ†å¸ƒå¼æ•°æ®åº“ç­‰äº§å“å¹¶å¤§è§„æ¨¡æœåŠ¡ç”µä¿¡é¢†åŸŸäº§å“ï¼›2014å¹´ç‡å…ˆæ‹“å±•é‡‘èè¡Œä¸šåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œè¯¥äº§å“å®Œå…¨è‡ªä¸»ç ”å‘å¹¶è·å¾—100å¤šé¡¹ç›¸å…³ä¸“åˆ©ã€‚é’ˆå¯¹é“¶è¡ŒOLTPä¸šåŠ¡ï¼Œä¸­å…´é€šè®¯åˆ†å¸ƒå¼æ•°æ®åº“GoldenDBä¸ºä¸šåŠ¡å¸¦æ¥ä¼ ç»Ÿå•æœºæ•°æ®åº“æ— æ³•æä¾›çš„è®¡ç®—åŠæ‰©å±•èƒ½åŠ›ï¼Œæä¾›é«˜ å¯ç”¨ã€é«˜å¯é ã€èµ„æºè°ƒåº¦çµæ´»çš„æ•°æ®åº“æœåŠ¡ï¼Œæ”¯æŒé‡‘èè¡Œä¸šå·²æœ‰ä¸šåŠ¡å‡çº§åŠåˆ›æ–°ä¸šåŠ¡å¿«é€Ÿéƒ¨ç½²çš„éœ€æ±‚ã€‚ä¸­å…´é€šè®¯GoldenDBåˆ†å¸ƒå¼æ•°æ®åº“ å·²ç»åœ¨ä¸­ä¿¡é“¶è¡Œã€æ±Ÿè‹çœå†œæ‘ä¿¡ç”¨ç¤¾è”åˆç¤¾ã€æ±Ÿè‹é“¶è¡Œã€æ¹–å—çœæ”¿åºœã€æ¹–åŒ—ä»™æ¡ƒå¸‚æ”¿åºœç­‰å•ä½æˆåŠŸå•†ç”¨ï¼Œä¸»è¦åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼šé«˜å¹¶å‘åœº æ™¯ï¼šé’ˆå¯¹æ”¿åºœã€é‡‘èã€è¿è¥å•†ã€äº’è”ç½‘ä¸šåŠ¡å¯¹æ•°æ®åº“çš„é«˜å¹¶å‘äº¤æ˜“çš„è¦æ±‚ï¼Œä¸”å¯ä»¥ä¿è¯æ•°æ®çš„äº‹åŠ¡å¼ºä¸€è‡´æ€§ã€‚æµ·é‡æ•°æ®å­˜å‚¨è®¿é—®åœºæ™¯ï¼š é’ˆå¯¹ç°æœ‰å•æœºæ•°æ®åº“çš„å­˜å‚¨å®¹é‡å’Œæ€§èƒ½é™åˆ¶ï¼Œæä¾›å¤§å®¹é‡ã€å¯æ°´å¹³å¹³æ»‘æ‰©å®¹çš„æ•°æ®åº“è§£å†³æ–¹æ¡ˆã€‚@@
"clean up ..."
drop database yxx;
